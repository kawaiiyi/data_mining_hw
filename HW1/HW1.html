<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>数据挖掘HW1-万怡</title>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
body{
    margin:30px;
}
h1{
 text-align: center;
background-color: cornflowerblue;
}
 h3{
    margin:20px;
 }
p{
    margin-left:45px;
}
img{
    width:60%;
    margin-left: 20%;
}
    </style>
</head>
<body>
    <h1>HW 1</h1>
    <h2>一、理论证明</h2>
    <h3>1、证明：已知针对模型 \( f \)，使用训练数据集得到的估计记为\( \hat{f} \)。现有独立于训练数据集的\( (x_0, y_0) \)， \( y_0 = f(x_0) + \epsilon \)，其中 \( \epsilon \) 为随机误差项，证明：
        \[ E\left[y_0 - \hat{f}(x_0)\right]^2 = Var(\hat{f}(x_0)) + \left[Bias(\hat{f}(x_0))\right]^2 + Var(\epsilon) \]
    </h3>
    <h3>证：</h3>
<p >\( E\left[(y_0 - \hat{f}(x_0))^2\right] \) </p>
  <p>= \(  E\left[(f(x_0) + \epsilon - \hat{f}(x_0))^2\right] \)</p>
<p> = \( E\left[(f(x_0) - \hat{f}(x_0))^2\right] + E\left[2\epsilon(f(x_0) - \hat{f}(x_0))\right] + E(\epsilon^2) \)</p>
<p>其中：</p>
<ul>
    <li>
        <p>\( E\left[(f(x_0) - \hat{f}(x_0))^2\right] \)</p>
<p> \(= E\left[(f(x_0) - E\left[ \hat{f}(x_0) \right] + E\left[ \hat{f}(x_0) \right] -\hat{f}(x_0))^2 \right] \)</p>
<p>\(= E\left[(f(x_0) - E\left[ \hat{f}(x_0) \right])^2 + 2(f(x_0) - E\left[ \hat{f}(x_0) \right])(E\left[ \hat{f}(x_0) \right] -\hat{f}(x_0)) + (E\left[ \hat{f}(x_0) \right] -\hat{f}(x_0))^2 \right]\)</p>
<p>\(= E\left[(f(x_0) - E\left[ \hat{f}(x_0) \right])^2\right] + 2 E\left[(f(x_0) - E\left[ \hat{f}(x_0) \right])(E\left[ \hat{f}(x_0) \right] -\hat{f}(x_0))\right] + E\left[(E\left[ \hat{f}(x_0) \right] -\hat{f}(x_0))^2 \right]\)</p>
<p>因为 \(f(x_0) - E\left[ \hat{f}(x_0) \right]\) 是常数，\( E\left[ E\left[ \hat{f}(x_0) \right] -\hat{f}(x_0)\right] = 0 \), 所以</p>
<p>\[ 2 E\left[(f(x_0) - E\left[ \hat{f}(x_0) \right])(E\left[ \hat{f}(x_0) \right] -\hat{f}(x_0))\right] = 2 \times (f(x_0) - E\left[ \hat{f}(x_0) \right]) \times E\left[ E\left[ \hat{f}(x_0) \right] -\hat{f}(x_0)\right]=0\]  </p>
<p>又因为 \(\left[Bias(\hat{f}(x_0))\right]^2 = (E\left[\hat{f}(x_0)\right]-f(x_0))^2 \)，所以</p>
<p>\( E\left[(f(x_0) - \hat{f}(x_0))^2\right] \)</p>
<p>\( = (f(x_0) - E\left[ \hat{f}(x_0) \right])^2 +  E\left[(E\left[ \hat{f}(x_0) \right] -\hat{f}(x_0))^2 \right]\)</p>
<p>\( =\left[Bias(\hat{f}(x_0))\right]^2 + Var(\hat{f}(x_0)) \)</p>
<p>即：</p>
<p>\[ E\left[(f(x_0) - \hat{f}(x_0))^2\right] = \left[Bias(\hat{f}(x_0))\right]^2 + Var(\hat{f}(x_0)) \]</p>
    </li>
    <li>
        <p>因为随机误差项\(\epsilon\) 和模型和预测之间有独立性，即 \(\epsilon\) 和 \(f(x_0) - \hat{f}(x_0)\) 是独立的；且 \( E(\epsilon) = 0 \) ，所以：</p>
        <p>\[ E\left[2\epsilon(f(x_0) - \hat{f}(x_0))\right] = 2 \times E(\epsilon) \times E\left[f(x_0)-\hat{f}(x_0) \right] = 0\]</p>
    </li>
    <li>
        <p>因为 \( E(\epsilon) = 0 \) ， 所以:</p>
        <p>\[ E(\epsilon^2) = Var(\epsilon) + (E(\epsilon))^2 = Var(\epsilon)\] </p>
    </li>
</ul>
<p>所以，左式 = 右式，得证，即</p>
<p> \[ E\left[y_0 - \hat{f}(x_0)\right]^2 = Var(\hat{f}(x_0)) + \left[Bias(\hat{f}(x_0))\right]^2 + Var(\epsilon) \]</p>
</br>
<h3>2、请简要叙述一个可以应用数据挖掘的分析场景。请具体说明：（1）该分析场景中需要解决的业务问题；（2）针对该问题需要收集的数据，以及该数据中的因变量和自变量信息。</h3>
    <p>
一个典型的应用数据挖掘的分析场景，如征信系统中的信用评分
<ol type="A">
    <li>
        需要解决的业务问题：
    </br>
        在征信系统中，核心的业务问题就是评估借款人未来违约（逾期还款）的风险，即利用现有的数据来预测借款人是否会在将来的一段时间内发生逾期还款
        </br>
        通过准确预测个人的信用风险，金融机构可以做出更加明智的贷款决策，包括是否贷款给个人以及贷款的具体额度、贷款利率等，从而减少坏账损失，优化资产配置，提高金融服务的整体效率和盈利性。
        
    </li>
</br>
    <li>
        为了建立信用评分模型，需要收集以下数据，即数据挖掘的自变量：
    </br>
    <ol type="a">
       自变量：
        <li> 用户基本信息：包括年龄、性别、教育水平、职业、婚姻状况、居住状况等。</li>
        <li>财务信息：包括收入水平、资产状况、负债情况、信用卡使用情况、其他贷款信息等。</li>
        <li>信用历史：包括借款人过去的借贷记录、还款记录、逾期记录、信用卡还款情况等。</li>
      
    </ol>
     <ol>因变量：
     </br>
        借款人在未来一段时间内是否发生逾期还款。它通常被定义为二元变量，如“1”表示逾期，“0”表示未逾期。
     </ol>
        通过分析自变量数据，数据挖掘模型可以识别出哪些因素与借款人的信用风险最相关，并预测未来是否会发生逾期还款，即预测因变量。这种预测对于金融机构在审批贷款、设定贷款利率、制定风险控制策略等方面至关重要。
    </li>
</ol>
    </p>
</br>
    <h2>二、案例分析</h2>
<h3><a href="https://github.com/kawaiiyi/data_mining_hw">源代码链接</a></h3>
<h3>1.读入样本数据data.csv（提前设置好工作路径），命名为video。使用summary()函数查看数据记录的变量等情况。</h3>
<p style="margin-left: 30px;">
    <strong>summary函数输出结果如下：</strong>
<pre ><code>
    序号         作者编号          点赞数            评论数           分享数           BGM                 时长         发布日期           发布时间             类别              标题字数    
    Min.   :   1   Min.   :   1.0   Min.   :  15165   Min.   :    28   Min.   :     3   Length:6400        Min.   : 4.40   Length:6400        Length:6400        Length:6400        Min.   : 0.00  
    1st Qu.:1601   1st Qu.: 531.8   1st Qu.: 309374   1st Qu.:  3216   1st Qu.:  2586   Class :character   1st Qu.:14.33   Class :character   Class :character   Class :character   1st Qu.:16.00  
    Median :3200   Median :1331.5   Median : 538962   Median :  7256   Median :  7796   Mode  :character   Median :24.79   Mode  :character   Mode  :character   Mode  :character   Median :26.00  
    Mean   :3200   Mean   :1280.6   Mean   : 651383   Mean   : 11702   Mean   : 21955                      Mean   :29.59                                                            Mean   :26.71  
    3rd Qu.:4800   3rd Qu.:1992.2   3rd Qu.: 844416   3rd Qu.: 14887   3rd Qu.: 24420                      3rd Qu.:45.50                                                            3rd Qu.:37.00  
    Max.   :6400   Max.   :2612.0   Max.   :4556768   Max.   :120245   Max.   :347589                      Max.   :60.04                                                            Max.   :72.00  
</code>
<code>
    发布时间
    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
    00:00:03 11:44:49 16:11:52 14:57:47 18:15:23 23:59:59 
</code></pre>
   <p style="margin-left: 30px;">
    <strong>summary的输出结果提供了每个变量的分布情况的概览，具体包括变量的最小值、第一四分位数、中位数、平均数、第三四分位数和最大值。各变量分布情况具体为：</strong>
<ul>
    <li>序号：视频标识符，表示数据集中有6400条记录。</li>
    <li>作者编号：作者标识符，表示参与的作者有2612个。</li>
    <li>点赞数：点赞数的范围从15165到4556768，说明视频的受欢迎程度差异很大。中位数为538962，意味着一半的视频点赞数低于538962，一半高于此值。</li>
    <li>评论数：评论数从28到120245不等，中位数7256表明一半的视频评论数低于7256，一半高于此数。</li>
    <li>分享数：分享数的范围从3到347589，中位数7796，这表明分享行为也呈现出较大的差异。</li>
    <li>BGM：这是背景音乐的信息，数据类型是字符（character），具体内容无法从摘要中得知。</li>
    <li>时长：视频的时长从4.40秒到60.04秒，中位数为24.79秒，说明一半的视频时长在24.79秒以下，一半以上。</li>
    <li>标题字数：标题字数从0到72不等，中位数为26，说明标题的长度也有所不同。</li>
    <li>发布日期：日期覆盖从2019年1月1日到2019年5月9日期间的129天。</li>
    <li>发布时间：24小时内，最早00:00:03发布，最晚23:59:59发布，中位数为16:11:52，一半的视频早于该时间点发布，另一半则晚于该时间点。</li>
</ul>
</p>
</p>

<h3>2. 进行描述性分析，包括但不限于以下方面：
    </h3>
    <h3>（1）绘制因变量点赞分布直方图，并进行适当解读；
        </h3>
        <img src="src/点赞分布直方图.png" alt="点赞分布直方图">
        <p>从上图中，我们可以分析知道：大部分视频的点赞数集中在较低的区间内，尤其是在0到100万之间。随着点赞数的增加，视频数量显著减少。点赞数在100万至200万之间的视频数量明显低于100万以下的数量。极少数视频达到了超高的点赞数，例如300万至500万区间内的视频数量非常少。
            点赞数最多的区间是0到50万之间，6400个视频中有近一半，即2904个视频属于此区间，点赞数最少是350到400万之间和450万到500万之间，两个区间内均只有1个视频。</p>
        <h3>
            （2）利用数据集中的发布时间变量，提取小时变量，命名为hour。使用折线图展示不同小时发布的短视频点赞数的差异，并进行适当解读；
        </h3>
        <img src="src/不同小时发布的短视频点赞数差异.png" alt="不同小时发布的短视频点赞数差异">
<p>
    <ul>
        <li>用户的点赞数在一天中的变化情况可以描述为如下：一天中的早晨时间（0点到6点）点赞数较低。从7点开始，点赞数有所增加，11点时，到大第一个相对峰值，然后点赞数开始回落，到了下午的15点左右达到一个相对较低估，然后开始回升，在17点左右到达第二个峰值，也是全天的峰值，然后开始随时间推移下跌。晚上的点赞数保持着较低水平。
            </li>
            <li>用户一天的点赞数最高是18点时，为659个赞；最低是4点时，仅为12个赞。</li>
            <li>用户的点赞数在一天中有两次急剧变化，分别是16时到17时，急剧上涨，以及18时到19时。急剧下跌。</li>
   
</ul>
    </p>
        <h3>（3）请使用分组箱线图对比不同类别的视频的点赞数差异，并进行适当解读。</h3>
        <img src="src/不同类别视频的点赞数差异.png" alt="不同类别视频的点赞数差异">
        <p>
            <ul>
                <li>
                    上述箱线图以不同的颜色代表不同类别的视频，对不同类别的视频点赞数的分布情况进行了直观描述。其中，每个箱体的底部和顶部边缘分别代表第一四分位数和第三四分位数。箱体的长度（表示中间50%数据的分布范围。
                    箱体内的横线代表中位数（50%分位数），是该类别点赞数的中点。
                   上须线表示，从箱体顶部向上延伸至第三四分位数+1.5倍四分位距的线，下须线表示，从箱体底部向下延伸至第一四分位数-1.5倍四分位距的线，单独的点代表那些超出须线范围的异常值。</p>
                </li>
                <li>“剧情”类别的点赞数中位数最高，“汽车”类别的点赞数中位数最低。</li>
                <li>“旅行”和“汽车”类别的点赞数分布较为集中，须线较短。
                    “宠物”类别的视频点赞数分布较广，有很多高点赞的异常值。</li>
                    
            </ul>
            
<h3>3.由于汽车类短视频的点赞数远低于其他类别视频，对非汽车类数据进行线性回归建模分析。首先提取非汽车类数据命名为video1。
    再将视频发布时间分为6个时段：“20:00-次日5:59”、“6:00-8:59”、“9:00-11:59”、“12:00-13:59”、“14:00-16:59”、“17:00-19:59”，分别命名为“夜间”“早间”“上午”“中午”“下午”“傍晚”，将该变量命名为“视频发布时间”。
    建立点赞数的双对数线性回归模型，因变量为对数点赞数，自变量包括：视频发布时段（基准组：夜间）、对数分享数、对数评论数、时长、类别（基准组：宠物）、标题字数，并对结果进行适当解读。</h3>
<p style="margin-left: 30px;">
    <pre><code>
    lm(formula = log(点赞数) ~ 视频发布时间 + log(分享数) + 
    log(评论数) + 时长 + 类别 + 标题字数, data = video1)

    Residuals:
        Min       1Q   Median       3Q      Max 
    -1.34324 -0.26640 -0.02106  0.24316  1.99196 

    Coefficients:
                    Estimate Std. Error t value Pr(>|t|)    
    (Intercept)      9.8739188  0.0554695 178.006  < 2e-16 ***
    视频发布时间早间 0.0053859  0.0280683   0.192  0.84784    
    视频发布时间上午 0.0164556  0.0191837   0.858  0.39104    
    视频发布时间中午 0.0322605  0.0208420   1.548  0.12172    
    视频发布时间下午 0.0169830  0.0208697   0.814  0.41582    
    视频发布时间傍晚 0.0444631  0.0172855   2.572  0.01013 *  
    log(分享数)      0.0995106  0.0042575  23.373  < 2e-16 ***
    log(评论数)      0.2301533  0.0061970  37.140  < 2e-16 ***
    时长             0.0027966  0.0003400   8.227 2.39e-16 ***
    类别剧情         0.8239373  0.0255712  32.221  < 2e-16 ***
    类别游戏         0.5392600  0.0181481  29.714  < 2e-16 ***
    类别穿搭         0.0290268  0.0178615   1.625  0.10420    
    类别美妆         0.3423557  0.0182776  18.731  < 2e-16 ***
    类别美食         0.4237840  0.0185328  22.867  < 2e-16 ***
    标题字数         0.0013278  0.0004022   3.301  0.00097 ***
    ---
    Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

    Residual standard error: 0.39 on 5385 degrees of freedom
    Multiple R-squared:  0.6178,	Adjusted R-squared:  0.6168 
    F-statistic: 621.6 on 14 and 5385 DF,  p-value: < 2.2e-16
    </code></pre>
    <p>上述线性回归模型预测基于不同自变量的视频点赞数的对数值，结果为
        \[log(点赞数) = 视频发布时间 + log(分享数) + log(评论数) + 时长 + 类别 + 标题字数\]
        以下是对结果的逐项解读：
<ul>
        <li>截距:估计值为9.8739188，标准误差为0.0554695，t 值为178.006，且 p 值小于2e-16，这表明截距是高度显著的。</li>
        
        <li>视频发布时间：不同发布时间段的系数显示了相对于基准组（夜间）的效果差异。除了“傍晚”时间段（系数为0.0444631，p值为0.01013，表示显著）外，其他时间段与点赞数的对数没有显著的统计联系。</li>
        
        <li>log(分享数)：分享数对数的系数为0.0995106，高度显著（p值<2e-16），说明分享数的对数每增加一个单位，预期的点赞数的对数会增加约0.0995106个单位。</li>
        
        <li>log(评论数)：评论数对数的系数为0.2301533，同样高度显著（p值<2e-16），表示评论数的对数每增加一个单位，点赞数的对数预期会增加约0.2301533个单位。</li>
        
        <li>时长：视频时长的系数为0.0027966，t值为8.227，p值为2.39e-16，这表示时长与点赞数的对数显著正相关，时长每增加一个单位，点赞数的对数预期会稍微增加。</li>
        
        <li>类别：视频类别的不同系数显示了与基准组（宠物）相比，其他类别的差异。例如，“剧情”类别的系数为0.8239373，非常显著（p值<2e-16），意味着剧情类别的视频比宠物类别视频的点赞数的对数要高出约0.824个单位。</li>
        
        <li>标题字数：标题字数的系数为0.0013278，t值为3.301，p值为0.00097，表示标题字数每增加一个单位，点赞数的对数预期会略微增加。</li>
        
        <li> 模型诊断：残差标准误差为0.39，表明模型的拟合度适中。多重R方值为0.6178，调整后R方值为0.6168，这表明自变量能够解释约61.78%的点赞数的变异性。F统计量为621.6，对应的p值远小于0.05，表明模型至少有一个预测变量是有效的。</li>
    </ul>
     <p>总的来说，模型表明评论数和分享数的对数是点赞数对数的显著预测因子，而某些视频类别（如剧情和美食）的点赞数也显著高于宠物类别。视频公布时间中，只有“傍晚”相对于“夜间”显著地影响点赞数。</p>
    </p>
</p>
   
<h3>4. 对第3问中建立的模型进行模型诊断，输出结果，并进行适当解读。</h3>
<p style="margin-left: 20px
;">
    模型诊断有助于验证回归模型假设的正确性，并识别可能需要进一步关注或调整的任何问题。这里进行以下几种诊断：
    <ol type="A">
        <li>
            <strong>残差与拟合值的关系图:</strong>
            绘制了残差（实际观察值与模型预测值之间的差异）与模型的拟合值（预测值）之间的关系图。这是为了检查同方差性（即残差的方差是否对所有的拟合值都是常数）和线性性（数据与回归线是否呈线性关系）。理想情况下，残差应随机分布在0线周围，没有明显的模式。如果残差图呈现出明显的结构或模式（如漏斗形或曲线），这可能意味着违反了同方差性或线性假设。          
        </li>
        <img src="src/残差vs拟合值.png" alt="残差vs拟合值">
        <li>
            <strong>残差的正态Q-Q图:</strong>
            qqnorm函数生成了一个正态Q-Q图，这是用来检查残差是否近似正态分布的工具。如果残差来自正态分布，那么这些点应该大致落在qqline提供的参考线上。如果点严重偏离这条线，则可能表明残差分布的偏离正态性。
            
        </li>
        <img src="src/正态Q-Q图.png" alt="正态Q-Q图">

        <li>
           <strong>方差膨胀因子（VIF）检查:</strong> 
            vif函数计算了方差膨胀因子，这是用来检测多重共线性的指标。如果模型中的预测变量高度相关，它们就可能不是独立的，这会影响模型系数的稳定性和解释。通常，VIF值大于5或10可能表示有共线性问题。
            
        </li>
        <pre>
            <code>
    GVIF Df GVIF^(1/(2*Df))
    视频发布时间 1.053205  5        1.005197
    log(分享数)  1.355851  1        1.164410
    log(评论数)  1.433478  1        1.197279
    时长         1.244913  1        1.115757
    类别         1.513183  5        1.042291
    标题字数     1.047382  1        1.023417
            </code>
        </pre>
        <ul>
            <li>视频发布时间的VIF值为1.053，这表明这个变量与其他变量之间几乎没有多重共线性。</li>
                <li>log(分享数)的VIF值为1.356，略高但仍在可接受范围内，没有明显的多重共线性迹象。</li>
                    <li> log(评论数)的VIF值为1.433，略高，但通常不被视为多重共线性的明显迹象。</li>
                        <li> 时长的VIF值为1.245，表明没有明显的多重共线性。</li>
                            <li> 类别的VIF值为1.513，这是一个较高的值，可能表明类别变量中的某些水平可能与模型中的其他变量或其他类别水平相关。</li>
                                <li> 标题字数的VIF值为1.047，表明没有多重共线性的问题。</li>
        </ul>
        <li>
            <strong>达宾-沃森（Durbin-Watson）测试:</strong>
            dwtest函数执行了达宾-沃森测试，这是用来检测残差中自相关的常用方法，特别是在时间序列数据中。自相关意味着模型中的残差并不是独立的。Durbin-Watson统计量的值介于0到4之间，接近2通常被认为是没有自相关的证据。值显著小于2可能表明正自相关，而显著大于2可能表明负自相关。
            
        </li>
        <pre>
            <code>
    data:  lm_model
    DW = 0.75608, p-value < 2.2e-16
    alternative hypothesis: true autocorrelation is greater than 0               
            </code>
        </pre>
        <p style="margin-left: 30px;">Durbin-Watson test用于检测残差中的一阶自相关性，DW值的范围是0到4。理想情况下，DW值接近2，这表明残差之间没有自相关性。DW值远离2（特别是远低于2）可能表明正自相关性，即一个正误差值后面很可能跟着另一个正误差值。
             测试得到的DW值为0.75608，远低于2，p值小于2.2e-16，这表明在模型的残差中存在正自相关。正自相关的存在可能会影响到回归系数估计的有效性。</p>
    </ol>
    <p>综上所述，虽然模型中没有出现明显的多重共线性问题，但自相关性测试表明存在正自相关，这可能需要进一步的调查和可能的模型修正，如考虑使用时间序列分析方法或引入滞后变量等来处理这种自相关性。</p>

</p>
</br>
</body>
</html>